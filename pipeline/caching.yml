include:
  - pipeline/templates.yml

cache:cargo:
  extends: .rust-template
  stage: cache
  rules:
    - changes:
        - Cargo.lock
  cache:
    policy: pull-push
  script:
    - cargo fetch --locked
    - mkdir -p ${CARGO_HOME}/bin
    - curl -LsSf https://get.nexte.st/latest/linux | tar zxf - -C ${CARGO_HOME}/bin
    - cargo nextest --version

cache:pnpm:
  extends: .node-template
  stage: cache
  rules:
    - changes:
        - service-app/pnpm-lock.yaml
  cache:
    policy: pull-push
  script:
    - pnpm --version